<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/main}" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="ISO-8859-1">
<title>Medical procedure appointment</title>
<link rel="stylesheet" type="text/css"
	href="/assets/css/jquery.dataTables.min.css">
<style>
table#dataTable tbody tr:hover {
	background-color: #71d1eb !important;
}
</style>
</head>
<body>
	<div layout:fragment="content">
		<br />
		<div class="content container">
			<ul class="nav nav-tabs nav-tabs-bottom nav-justified">
				<li class="nav-item"><a class="nav-link active"
					href="#bottom-justified-tab1" data-toggle="tab">Patients in
						charge</a></li>
			</ul>
			<div class="tab-content">
				<div class="tab-pane show active" id="bottom-justified-tab1">
					<div class="row">
						<div class="col-sm-4 col-3">
							<h4 class="page-title">Providing Treatment Method For
								Illness</h4>
						</div>
						<div class="col-sm-8 col-9 text-right m-b-20">
							<!-- 					<a th:href="${'/admin/treatmentmethodillness/create'}" -->
							<!-- 						class="btn btn btn-primary btn-rounded float-right"><i -->
							<!-- 						class="fa fa-plus"></i> Add Treatment Method For Illness</a> -->
						</div>
					</div>
					<div class="row">
						<div class="col-md-12">
							<div class="table-responsive">
								<button class="btn btn-primary" id="patientDetail">Detail</button>
								<button class="btn btn-secondary" id="patientProfile">Illness
									Profile</button>
								<button class="btn btn-danger" id="profileReject">Reject
									Profile</button>
								<table
									class="table table-border table-striped custom-table mb-0"
									id="dataTable">
									<thead>
										<tr>
											<th>Appointment ID</th>
											<th>Patient</th>
											<th>Doctor</th>
											<th>Date</th>
											<th>Shift</th>
											<th>Stage</th>	
											<th>Status</th>																			
											<th>Note</th>
											<th>Created By</th>
											<th>Created Date</th>
											<th>Modified By</th>
											<th>Modified Date</th>
<!-- 											<th class="text-right">Action</th> -->
										</tr>
									</thead>
									<tbody id="SetList">
										<tr id="LoadingStatus" style="color: red">
											<td class="row_1"></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>											
										</tr>
									</tbody>
									<tfoot></tfoot>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		
<!-- 		Patient Detail modal -->
<div id="MyModal" class="modal fade">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" align="center">
                <h4 class="col-sm-12 modal-title text-center" align="center">
                    <h id="ModalTitle"></h>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </h4>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-7 col-6">
                        <h4 class="page-title">Patient Profile</h4>
                    </div>

<!--                     <div class="col-sm-5 col-6 text-right m-b-30"> -->
<!--                         <a href="edit-profile.html" class="btn btn-primary btn-rounded"><i class="fa fa-plus"></i> Edit Profile</a> -->
<!--                     </div> -->
                </div>
                <div class="card-box profile-header">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="profile-view">
                                <div class="profile-img-wrap">
                                    <div class="profile-img">
                                        <a href="#"><img class="avatar" src="assets/img/doctor-03.jpg" alt=""></a>
                                    </div>
                                </div>
                                <div class="profile-basic">
                                    <div class="row">
                                        <div class="col-md-5">
                                            <div class="profile-info-left">
                                                <h3 class="user-name m-t-0 mb-0" id="PatientName">Cristina Groves</h3>
<!--                                                 <small class="text-muted">Gynecologist</small> -->
                                                <div class="staff-id" id="PatientID">Employee ID : DR-0001</div>
                                            </div>
                                        </div>
                                        <div class="col-md-7">
                                            <ul class="personal-info">
                                                <li>
                                                    <span class="title">Phone:</span>
                                                    <span class="text" id="Phone"><a href="#">770-889-6484</a></span>
                                                </li>
                                                <li>
                                                    <span class="title">Email:</span>
                                                    <span class="text" id="Email"><a href="#">cristinagroves@example.com</a></span>
                                                </li>
                                                <li>
                                                    <span class="title">Birthday:</span>
                                                    <span class="text" id="DOB">3rd March</span>
                                                </li>
                                                <li>
                                                    <span class="title">Address:</span>
                                                    <span class="text" id="Address">714 Burwell Heights Road, Bridge City, TX, 77611</span>
                                                </li>
                                                <li>
                                                    <span class="title">Gender:</span>
                                                    <span class="text" id="Gender">Female</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>                        
                        </div>
                    </div>
                </div>
				<div class="profile-tabs">
					<ul class="nav nav-tabs nav-tabs-bottom">
						<li class="nav-item"><a class="nav-link active" href="#about-cont" data-toggle="tab">About</a></li>
					</ul>

					<div class="tab-content">
						<div class="tab-pane show active" id="about-cont">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card-box">
                            <h3 class="card-title">Illness Record</h3>
                            <div class="experience-box">
                                <ul class="experience-list" id="IllnessList">
                                    <li>
                                        <div class="experience-user">
                                            <div class="before-circle" id="LoadingStatus"></div>
                                        </div>
                                    </li>
<!--                                     <li> -->
<!--                                         <div class="experience-user"> -->
<!--                                             <div class="before-circle"></div> -->
<!--                                         </div> -->
<!--                                         <div class="experience-content"> -->
<!--                                             <div class="timeline-content"> -->
<!--                                                 <a href="#/" class="name">International College of Medical Science (PG)</a> -->
<!--                                                 <div>MD - Obstetrics & Gynaecology</div> -->
<!--                                                 <span class="time">1997 - 2001</span> -->
<!--                                             </div> -->
<!--                                         </div> -->
<!--                                     </li> -->
                                </ul>
                            </div>
                        </div>
<!--                         <div class="card-box mb-0"> -->
<!--                             <h3 class="card-title">Experience</h3> -->
<!--                             <div class="experience-box"> -->
<!--                                 <ul class="experience-list"> -->
<!--                                     <li> -->
<!--                                         <div class="experience-user"> -->
<!--                                             <div class="before-circle"></div> -->
<!--                                         </div> -->
<!--                                         <div class="experience-content"> -->
<!--                                             <div class="timeline-content"> -->
<!--                                                 <a href="#/" class="name">Consultant Gynecologist</a> -->
<!--                                                 <span class="time">Jan 2014 - Present (4 years 8 months)</span> -->
<!--                                             </div> -->
<!--                                         </div> -->
<!--                                     </li> -->
<!--                                     <li> -->
<!--                                         <div class="experience-user"> -->
<!--                                             <div class="before-circle"></div> -->
<!--                                         </div> -->
<!--                                         <div class="experience-content"> -->
<!--                                             <div class="timeline-content"> -->
<!--                                                 <a href="#/" class="name">Consultant Gynecologist</a> -->
<!--                                                 <span class="time">Jan 2009 - Present (6 years 1 month)</span> -->
<!--                                             </div> -->
<!--                                         </div> -->
<!--                                     </li> -->
<!--                                     <li> -->
<!--                                         <div class="experience-user"> -->
<!--                                             <div class="before-circle"></div> -->
<!--                                         </div> -->
<!--                                         <div class="experience-content"> -->
<!--                                             <div class="timeline-content"> -->
<!--                                                 <a href="#/" class="name">Consultant Gynecologist</a> -->
<!--                                                 <span class="time">Jan 2004 - Present (5 years 2 months)</span> -->
<!--                                             </div> -->
<!--                                         </div> -->
<!--                                     </li> -->
<!--                                 </ul> -->
<!--                             </div> -->
<!--                         </div> -->
                    </div>
                </div>
						</div>
					</div>
				</div>          
            </div>
        </div>
    </div>
</div>

		<script th:inline="javascript">
			$(document).ready(function() {
// 				$("#LoadingStatus").html("Loading....");
				loaddata();
			});

			function loaddata() {
				var doctorID = $('#userSessionId').val();
				var table = $("#dataTable")
						.DataTable(
								{
									"ajax" : {
										"url" : "/admin/appointment/getAllAppointmentByDoctorID/"+doctorID, //doctor should get from login session
										"type" : "GET",
										"datatype" : "json",
										"dataSrc" : function(json) {
											for (var i = 0; i < json.length; i++) {
												json[i][0] = json[i].appId;
												json[i][1] = json[i].patient.name;
												json[i][2] = json[i].employee.firstName;
												json[i][3] = json[i].date;
												json[i][4] = json[i].shiftId;
												json[i][5] = json[i].stage;
												json[i][6] = json[i].status ? '<span class="custom-badge status-green">Active</span>'
														: '<span class="custom-badge status-red">Inactive</span>';
												json[i][7] = json[i].note;
												json[i][8] = json[i].createdBy;
												json[i][9] = json[i].createdDate;
												json[i][10] = json[i].modifiedBy;
												json[i][11] = json[i].modifiedDate;
											}
											return json;
										}
									},
									"language" : {
										"emptyTable" : "No data found, please add new"
									}
								});
				$('#dataTable tbody').on('click', 'tr', function () {
			        if ( $(this).hasClass('selected') ) {
			            $(this).removeClass('selected');
			        }
			        else {
			            table.$('tr.selected').removeClass('selected');
			            $(this).addClass('selected');
			        }
		        });
				
				$('#patientDetail').click( function () {
		            if(table.$('tr').hasClass('selected')==false){
		            	alert("Please select patient to continue the process!");
		            }else{
			            var tr = $(this).closest('tr');
			            var row = table.row(tr);
						var url = "/admin/patient/getPatientDetailByID/" + table.row('.selected').data().patient.patientId;
			            var url2 = "/admin/patient/getAllPatientIllnessByPatientID/" + table.row('.selected').data().patient.patientId;		            
//	 					var url2 = "/admin/patient/getPatientDetailByID/1";

			            $("#ModalTitle").html("Patient Detail");
			            $("#MyModal").modal();
			            $.ajax({
			                type: "GET",
			                url: url,
			                success: function (data) {		                    
				                $("#PatientName").html(data.name);
				                $("#PatientID").html("Patient ID: "+data.patientId);
				                $("#Phone").html(data.phone);
				                $("#Email").html(data.email);
				                $("#DOB").html(data.dob);
				                $("#Address").html(data.address);
					            $.ajax({
					                type: "GET",
					                url: url2,
					                success: function (data) {
					                	var SetData = $("#IllnessList");
					                	for (var i = 0; i < data.length; i++) {
					                		
					                        var list = 
			                             "<li>"+
			                                "<div class='experience-user'>"+
			                                    "<div class='before-circle'></div>"+
			                                "</div>"+
			                                "<div class='experience-content'>"+
			                                    "<div class='timeline-content'>"+
			                                        "<a href='#/' class='name'>Illness: "+data[i].name+"</a>"+
			                                        "<div>Degree: "+data[i].degree+"</div>"+
			                                        "<span class='time'>"+data[i].dianogsisTime+"</span>"+
			                                    "</div>"+
			                                "</div>"+
			                            "</li>";
					                	
//			 		                        $("#LoadingStatus").remove();
					                        SetData.append(list);
//			 		                        $("#LoadingStatus").html(" ");
					                }
					                }
					            })
			                }
			            });
		            }
		        });
				
				$('#patientProfile').click( function () {
		            if(table.$('tr').hasClass('selected')==false){
		            	alert("Please select patient to continue the process!");
		            }else{
		            	var tr = $(this).closest('tr');
		            	var row = table.row(tr);
						var url = "/admin/procedure/profile/" + table.row('.selected').data().appId;
						window.location.href = url;
		            }
		        });
				
				$('#profileReject').click( function () {
		            
		            if(table.$('tr').hasClass('selected')==false){
		            	alert("Please select patient to continue the process!");
		            }else{
		            	var tr = $(this).closest('tr');
		            	var row = table.row(tr);
						var url = "/admin/appointment/RejectProfile/" + table.row('.selected').data().appId;
						window.location.href = url;
		            }

		        });
			}
			
			// 			//Delete
			// 			var id;

			// 			function DeleteRecord(ID) {
			// 				id = ID;
			// 				$("#deleteConfirm").modal("show");
			// 			}

			// 			function ConfirmDelete() {
			// 				$.ajax({
			// 					type : "POST",
			// 					url : "/admin/illness/illness/delete?id=" + id,
			// 					success : function(result) {
			// 						window.location.href = "/admin/illness/illness/index";
			// 						$("#DeleteConfirm").modal("hide");
			// 					}
			// 				})
			// 			}
		</script>
	</div>
</body>
</html>